USE CAID
GO 
 
 
 DECLARE ESPECIALISDADID VARCHAR(100) = '3158F182-C09B-4400-88BB-15370566E4BD'

 SELECT * FROM [SMX30002]  WHERE NOMBRE LIKE '%CERO%' ORDER BY ROWMDTE DESC

  
-- LISTADO DE SERVICIOS 
-- exec SMX30002SI @NOMBRE=N'CONSULTA CERO HABILIDADES SOCIALES',@tipoid=N'3158F182-C09B-4400-88BB-15370566E4BD', @ROWGUID='CAID-SD-HS-01',@ROWUSERID=N'64C361FA-686D-4714-ACE2-028E4A3C1F25',@ROWSGXID=N'CAID-SD' 

----------------------------------------------------------------------------------------------------------
 -- CREA SERVICIOS A PLANES
insert into SMX00202
          (TARIFAID, PLANID  , NETO, SEGUROO, COPAGO,  ROWGUID             , ROWCDTE           , ROWMDTE  , ROWUSERID   , ROWSGXID)
SELECT    o.ROWGUID, N.ROWGUID , 0     ,0     ,0      ,  NEWID() AS ROWGUID  , GETDATE() ROWCDTE , GETDATE(),'CAID-SD-SA' ,'CAID-SD'
FROM	SMX00201 n  , SMX30002 o
		--  ON m.TARIFAID = o.ROWGUID 
WHERE	o.nombre like '%CONSULTA CERO HABILIDADES SOCIALES%'
ORDER BY N.ARSID, O.ROWGUID


------------------------------------------------------------------------------------------------------------

 -- CREA SERVICIOS A PLAN SENASA CONTRIBUTIVO
insert into SMX00202
          (TARIFAID, PLANID  , NETO, SEGUROO, COPAGO,  ROWGUID             , ROWCDTE           , ROWMDTE  , ROWUSERID   , ROWSGXID)
SELECT    o.ROWGUID, N.ROWGUID , 0     ,0     ,0      ,  NEWID() AS ROWGUID  , GETDATE() ROWCDTE , GETDATE(),'CAID-SD-SA' ,'CAID-SD'
FROM	SMX00201 n  , SMX30002 o
		--  ON m.TARIFAID = o.ROWGUID 
WHERE O.ROWGUID NOT IN ('CAID-SD-HS-01','CAID-SD-TC0-01')
AND O.NOMBRE LIKE  '%CONSULTA CERO%'
AND N.ROWGUID ='8B3BEFBB-B05F-40E8-967A-17DB0D2A5436'

 SELECT * FROM SMX00201 WHERE NOMBRE LIKE '%CONTRIBU%'
 

 --------------------------------------------------
 /*
 PARA CORREGIR EL CAMPO PLANID DE LA TABLA SMX00201 

 SELECT   m.PLANID, n.ROWGUID
FROM	SMX00202 m 
		INNER JOIN SMX00201 n ON m.PLANID = n.ARSID 
		INNER JOIN SMX30002 o ON m.TARIFAID = o.ROWGUID 
WHERE	o.nombre like '%picto%' AND
CAST(O.ROWCDTE AS DATE) = '2017-08-02'and 
m.PLANID <>'00000000-0000-0000-0000-000000000000'
 

 update m set m.PLANID = n.ROWGUID
FROM	SMX00202 m 
		INNER JOIN SMX00201 n ON m.PLANID = n.ARSID 
		INNER JOIN SMX30002 o ON m.TARIFAID = o.ROWGUID 
WHERE	o.nombre like '%cero%' AND
CAST(O.ROWCDTE AS DATE) = '2017-08-02' and 
m.PLANID <>'00000000-0000-0000-0000-000000000000'

*/